#!/usr/bin/env bash
# -----------------------------------------------------------------------------
# Name          :mkscr
# Description   :Create an executable shell script with header section. The
#                template script will be opened in Vim. Original script,
#Â                modified from <http://code.activestate.com/recipes/577862>.
# Author        :Merlin Unterfinger <info@munterfinger.ch>
# Date          :2020-05-17
# Version       :0.1.0
# Usage         :./mkscr or mkscr if located in ~/bin
# Notes         :Vim has to be installed and requires Bash version > 4.0.0
# Bash          :5.0.17(1)-release
# =============================================================================

today=$(date +%Y-%m-%d)
div1="--------------------------------------"
div2="======================================"

/usr/bin/clear

_select_title(){

    # Get the user input.
    printf "Enter the script name:     " ; read -r title

    # Remove the spaces from the title if necessary.
    title=${title// /_}

    # Convert uppercase to lowercase.
    title=${title,,}

    # Add .sh to the end of the title if it is not there already.
    [ "${title: -3}" != '.sh' ] && title=${title}.sh

    # Check to see if the file exists already.
    if [ -e $title ] ; then
        printf "\n%s\n%s\n\n" "The script \"$title\" already exists." \
        "Please select another file name."
        _select_title
    fi

}

_select_title
printf "Enter a description:       " ; read -r dscrpt
name="$(git config user.name) <$(git config user.email)>"
printf "Enter the author name:     " ; read -re -i "$name" name
vnum="0.1.0"
printf "Enter the version number:  " ; read -re -i "$vnum" vnum

# Format the output and write it to a file.
printf "%-16s\n\
%-80s\n\
%-16s%-8s\n\
%-16s%-8s\n\
%-16s%-8s\n\
%-16s%-8s\n\
%-16s%-8s\n\
%-16s%-8s\n\
%-16s%-8s\n\
%-16s%-8s\n\
%s\n\n\n" '#!/usr/bin/env bash'  "# -$div1$div1" '# Name' ":$title" \
'# Description' ":${dscrpt}" '# Author' ":$name" '# Date' ":$today" \
'# Version' ":$vnum" '# Usage' ":./$title" '# Notes' ':' '# Bash' \
":${BASH_VERSION}" "# =$div2$div2" > $title

# Make the file executable.
chmod +x $title

/usr/bin/clear

# Open the file with the cursor on the correct line.
vim +13 $title
